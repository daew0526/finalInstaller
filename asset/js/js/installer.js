(()=>{class e extends class{constructor(e,t,s,n){this.sx=e,this.sy=t,this.ex=s,this.ey=n}}{constructor(){super(t,s,n,c),this.name=`square ${a.length+1}`}}let t,s,n,c,o,r,a=[],i=[],l=[],u=-1,d=!1,m="square";const y=document.querySelector(".container"),h=document.getElementById("canvas"),v=h.getContext("2d"),f=document.querySelector(".js-square"),g=(document.querySelector(".js-circle"),document.querySelector(".js-range"),document.querySelector(".js-restore")),S=document.querySelector(".save_btn"),p=document.querySelector(".save__container"),q=document.querySelector("main");let x,L;const E=async()=>{const e=document.querySelector(".save__container input").value,t={imageUrl:x,value:e},s=await fetch(`/api/interior/${L}/save`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});201===s.status&&(p.classList.remove("active"),q.classList.remove("active"),document.querySelector(".home").click()),s.status},k=()=>{localStorage.setItem(m,JSON.stringify(a)),localStorage.setItem("circle",JSON.stringify(i))},_=()=>{v.clearRect(0,0,h.width,h.height);for(let e=0;e<a.length;e++){let t=a[e];v.strokeRect(t.sx,t.sy,t.ex-t.sx,t.ey-t.sy)}};v.fillStyle="orange",h&&(h.width=1e3,h.height=1e3,h.addEventListener("mousedown",(e=>{const{offsetX:n,offsetY:c}=e;t=n,s=c,o&&(u=((e,t)=>{for(let s=0;s<a.length;s++){let n=a[s];if(e>n.sx&&e<n.ex&&t>n.sy&&t<n.ey)return s}return-1})(t,s),-1===u&&(d=!0))})),h.addEventListener("mousemove",(e=>{const{offsetX:o,offsetY:r}=e;if(n=o,c=r,d)_(),v.strokeRect(t,s,n-t,c-s);else if(-1!=u){const e=a[u],o=n-t,r=c-s;e.sx+=o,e.sy+=r,e.ex+=o,e.ey+=r,t=n,s=c,k(),_()}})),h.addEventListener("mouseup",(()=>{if(d){let o=Math.min(t,n),r=Math.min(s,c),i=Math.max(t,n),u=Math.max(s,c);const d=new e(o,r,i,u);a.push(d),l.push(d),k()}d=!1,u=-1}))),f&&f.addEventListener("click",(()=>{!0===o?(o=!1,f.innerText="사각형"):(o=!0,r=!1,f.innerText="사각형 사용중")})),g&&g.addEventListener("click",(()=>{const e=l.pop().name.substring(0,6);"square"===e&&(a.pop(),k()),"circle"===e&&(i.pop(),k()),_()})),S&&S.addEventListener("click",(()=>{L=y.dataset.userId,x=h.toDataURL("image/png"),p.classList.add("active"),q.classList.add("active"),document.querySelector(".save__container button").addEventListener("click",E)})),(()=>{const e=localStorage.getItem(m);if(null!==e){const t=JSON.parse(e);a=t,l=t,_()}})()})();